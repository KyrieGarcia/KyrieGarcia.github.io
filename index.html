<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poot's Expense Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            line-height: 1.8;
            font-size: 16px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #8B1538;
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
            font-weight: bold;
        }

        h2 {
            font-size: 24px;
            font-weight: bold;
        }

        h3 {
            font-size: 20px;
            font-weight: bold;
        }

        .success-message {
            background-color: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 20px;
            display: none;
            font-size: 18px;
            font-weight: bold;
        }

        .form-section {
            background-color: #fef5fb;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid #8B1538;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
            font-size: 16px;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        select {
            width: 100%;
            padding: 14px;
            border: 2px solid #333;
            border-radius: 5px;
            font-size: 18px;
        }

        input:focus,
        select:focus {
            outline: 3px solid #8B1538;
            border-color: #8B1538;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            font-weight: bold;
            min-height: 44px;
        }

        .btn-add {
            background-color: #4CAF50;
            color: white;
            width: 100%;
            margin-top: 10px;
        }

        .btn-add:hover {
            background-color: #45a049;
        }

        .btn-delete {
            background-color: #f44336;
            color: white;
            padding: 12px 20px;
            font-size: 16px;
        }

        .btn-delete:hover {
            background-color: #da190b;
        }

        .btn-clear {
            background-color: #ff9800;
            color: white;
            margin-top: 20px;
        }

        .btn-clear:hover {
            background-color: #e68900;
        }

        .filter-section {
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border: 2px solid #ddd;
        }

        .filter-section label {
            display: inline-block;
            margin-right: 15px;
            font-size: 16px;
        }

        .filter-section select {
            width: 250px;
            display: inline-block;
            font-size: 18px;
            padding: 12px;
        }

        .summary-section {
            background: #8B1538;
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .summary-section h2 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .total-amount {
            font-size: 48px;
            font-weight: bold;
            margin: 15px 0;
        }

        .transaction-count {
            font-size: 18px;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            background-color: #8B1538;
            color: white;
            padding: 14px;
            text-align: left;
            font-weight: bold;
            font-size: 16px;
        }

        td {
            padding: 14px;
            border-bottom: 2px solid #ddd;
            font-size: 16px;
        }

        tr:nth-child(even) {
            background-color: #fef5fb;
        }



        .empty-message {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
        }

        .amount-cell {
            font-weight: bold;
            color: #8B1538;
            font-size: 20px;
        }

        .category-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
        }

        .category-food { background-color: #fff3cd; color: #856404; }
        .category-transport { background-color: #d1ecf1; color: #0c5460; }
        .category-entertainment { background-color: #f8d7da; color: #721c24; }
        .category-shopping { background-color: #d4edda; color: #155724; }
        .category-bills { background-color: #e2e3e5; color: #383d41; }
        .category-other { background-color: #e7e7e7; color: #383838; }

        .chart-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #fef5fb;
            border-radius: 10px;
            border: 2px solid #8B1538;
        }

        .chart-section h2 {
            color: #8B1538;
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .chart-container {
            max-width: 500px;
            margin: 0 auto 20px;
            position: relative;
            height: 400px;
        }

        #expenseChart {
            max-width: 100%;
            height: auto;
        }

        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #8B1538;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 14px 24px;
            font-size: 18px;
            cursor: pointer;
            color: #666;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            min-height: 50px;
        }

        .tab-btn:hover {
            color: #8B1538;
            background-color: #f0f0f0;
        }

        .tab-btn.active {
            color: #8B1538;
            border-bottom: 3px solid #8B1538;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .savings-section {
            background-color: #fef5fb;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #8B1538;
        }

        .accounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .account-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .account-header h4 {
            color: #333;
            margin: 0 0 10px 0;
            font-size: 20px;
        }

        .account-balance {
            font-size: 28px;
            font-weight: bold;
            color: #8B1538;
            margin-bottom: 15px;
        }

        .account-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 12px 16px;
            font-size: 16px;
            flex: 1;
            min-height: 44px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 35px;
            border-radius: 10px;
            width: 90%;
            max-width: 550px;
            position: relative;
            border: 3px solid #8B1538;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 20px;
        }

        .close:hover {
            color: #8B1538;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .summary-value {
            font-size: 32px;
            font-weight: bold;
        }

        .plus-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
        }

        .plus-btn:hover {
            background-color: #45a049;
        }

        .account-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: white;
            border: 2px solid #8B1538;
            border-radius: 10px;
        }

        .account-section-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ddd;
        }

        .account-section-title {
            font-size: 22px;
            font-weight: bold;
            color: #8B1538;
            margin: 0;
        }

        .category-row {
            background-color: #f9f9f9;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .category-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .category-balance {
            font-size: 24px;
            font-weight: bold;
            color: #8B1538;
        }

        .category-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .category-actions .btn-add-money {
            width: 100%;
        }

        .category-actions .btn-remove-money,
        .category-actions .btn-delete {
            flex: 1;
        }

        .add-category-form {
            background-color: #fff9e6;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px dashed #8B1538;
            border-radius: 8px;
        }

        .add-category-form input {
            margin-bottom: 10px;
        }

        .add-category-form .btn {
            margin-right: 10px;
        }

        .accounts-overview,
        #accountsDetailView {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .account-detail-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #8B1538;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .account-detail-card h3 {
            color: #8B1538;
            margin: 0 0 15px 0;
            font-size: 22px;
        }

        .account-balance-large {
            font-size: 36px;
            font-weight: bold;
            color: #8B1538;
            margin-bottom: 15px;
        }



        .cash-breakdown {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #ddd;
        }

        .cash-category-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            color: #333;
            font-size: 16px;
            border-bottom: 1px solid #eee;
        }

        .cash-category-item:last-child {
            border-bottom: none;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #8B1538;
            text-align: center;
        }



        .stat-value {
            font-size: 22px;
            font-weight: bold;
            color: #8B1538;
        }

        .stat-label {
            font-size: 16px;
        }

        .category-edit-btn {
            background: none;
            border: none;
            color: #8B1538;
            cursor: pointer;
            font-size: 14px;
            padding: 4px 8px;
            text-decoration: underline;
        }

        .category-edit-btn:hover {
            color: #6B0F2A;
        }

        .chart-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .legend-details {
            flex: 1;
        }

        .legend-category {
            font-weight: bold;
            font-size: 16px;
            color: #333;
        }

        .legend-amount {
            color: #8B1538;
            font-weight: bold;
            font-size: 16px;
        }

        .legend-percentage {
            color: #666;
            font-size: 14px;
        }

        .no-data-message {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8em;
            }

            .total-amount {
                font-size: 2em;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 8px;
            }

            .filter-section select {
                width: 100%;
                margin-top: 10px;
            }

            .chart-container {
                height: 300px;
            }

            .chart-legend {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Poot's Expense Tracker</h1>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('expenses')">Expenses</button>
            <button class="tab-btn" onclick="switchTab('savings')">Savings</button>
            <button class="tab-btn" onclick="switchTab('accounts')">Accounts</button>
            <button class="tab-btn" onclick="switchTab('statistics')">Statistics</button>
        </div>

        <div id="successMessage" class="success-message">
            Expense added successfully!
        </div>

        <!-- TAB 1: EXPENSES -->
        <div id="expensesTab" class="tab-content active">

        <!-- Add Expense Form -->
        <div class="form-section">
            <h2 style="color: #8B1538; margin-bottom: 20px;">Add New Expense</h2>
            <form id="expenseForm">
                <div class="form-group">
                    <label for="description">Description</label>
                    <input type="text" id="description" placeholder="e.g., Coffee" required>
                </div>

                <div class="form-group">
                    <label for="amount">Amount (₱)</label>
                    <input type="number" id="amount" placeholder="0.00" step="0.01" min="0" required>
                </div>

                <div class="form-group">
                    <label for="category">Category</label>
                    <select id="category" required>
                        <option value="">Select a category</option>
                        <option value="Food">Food</option>
                        <option value="Transport">Transport</option>
                        <option value="Entertainment">Entertainment</option>
                        <option value="Shopping">Shopping</option>
                        <option value="Bills">Bills</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="paidFrom">Paid From (Select Category)</label>
                    <select id="paidFrom" required>
                        <option value="">Select payment source</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="date">Date</label>
                    <input type="date" id="date" required>
                </div>

                <button type="submit" class="btn btn-add">Add Expense</button>
            </form>
        </div>

        <!-- Summary Section -->
        <div class="summary-section">
            <h2 style="font-size: 24px; margin-bottom: 10px;">Total Expenses</h2>
            <div class="total-amount" id="totalAmount">₱0.00</div>
            <div class="transaction-count" id="transactionCount">0 transactions</div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <label for="filterCategory">Filter by Category:</label>
            <select id="filterCategory">
                <option value="all">All Categories</option>
                <option value="Food">Food</option>
                <option value="Transport">Transport</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Shopping">Shopping</option>
                <option value="Bills">Bills</option>
                <option value="Other">Other</option>
            </select>
            <button class="btn btn-clear" onclick="clearAllExpenses()">Clear All</button>
        </div>

        <!-- Expenses Table -->
        <div class="table-container">
            <table id="expenseTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Description</th>
                        <th>Category</th>
                        <th>Paid From</th>
                        <th>Amount</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="expenseTableBody">
                    <tr>
                        <td colspan="6" class="empty-message">No expenses yet. Add your first expense above!</td>
                    </tr>
                </tbody>
            </table>
        </div>

        </div>
        <!-- END EXPENSES TAB -->

        <!-- TAB 2: SAVINGS -->
        <div id="savingsTab" class="tab-content">
            <h2 style="color: #8B1538; margin-bottom: 25px; font-size: 26px;">Manage Your Savings</h2>
            
            <!-- GCash Section -->
            <div class="account-section">
                <div class="account-section-header">
                    <h3 class="account-section-title">GCash</h3>
                    <button class="plus-btn" onclick="showAddCategoryForm('GCash')" title="Add GCash Category">+</button>
                </div>
                <div id="addGCashForm" style="display: none;"></div>
                <div id="gcashCategoriesContainer">
                    <!-- GCash categories will be dynamically added here -->
                </div>
            </div>

            <!-- SeaBank Section -->
            <div class="account-section">
                <div class="account-section-header">
                    <h3 class="account-section-title">SeaBank</h3>
                    <button class="plus-btn" onclick="showAddCategoryForm('SeaBank')" title="Add SeaBank Category">+</button>
                </div>
                <div id="addSeaBankForm" style="display: none;"></div>
                <div id="seabankCategoriesContainer">
                    <!-- SeaBank categories will be dynamically added here -->
                </div>
            </div>

            <!-- Cash Section -->
            <div class="account-section">
                <div class="account-section-header">
                    <h3 class="account-section-title">Cash</h3>
                    <button class="plus-btn" onclick="showAddCategoryForm('Cash')" title="Add Cash Category">+</button>
                </div>
                <div id="addCashForm" style="display: none;"></div>
                <div id="cashCategoriesContainer">
                    <!-- Cash categories will be dynamically added here -->
                </div>
            </div>
        </div>
        <!-- END SAVINGS TAB -->

        <!-- TAB 3: ACCOUNTS -->
        <div id="accountsTab" class="tab-content">
            <h2 style="color: #8B1538; margin-bottom: 20px; font-size: 26px;">Accounts Overview</h2>
            
            <!-- Total Balance Summary -->
            <div class="summary-section" style="margin-bottom: 30px;">
                <h2 style="font-size: 24px; margin-bottom: 15px;">Total Balance Summary</h2>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">Total Savings</div>
                        <div class="summary-value" id="totalSavings">₱0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Total Spent</div>
                        <div class="summary-value" id="totalSpent">₱0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Remaining Balance</div>
                        <div class="summary-value" id="remainingBalance">₱0.00</div>
                    </div>
                </div>
            </div>

            <!-- Account Cards -->
            <div id="accountsDetailView">
                <!-- Will be populated dynamically -->
            </div>
        </div>
        <!-- END ACCOUNTS TAB -->

        <!-- TAB 4: STATISTICS -->
        <div id="statisticsTab" class="tab-content">
            <h2 style="color: #8B1538; margin-bottom: 20px; font-size: 26px;">Spending Statistics</h2>
            
            <!-- Time Period Filter -->
            <div class="filter-section">
                <label style="font-weight: bold; margin-right: 15px;">Time Period:</label>
                <label style="margin-right: 10px;">
                    <input type="radio" name="timePeriod" value="weekly" onchange="updateStatistics()"> Weekly
                </label>
                <label style="margin-right: 10px;">
                    <input type="radio" name="timePeriod" value="monthly" checked onchange="updateStatistics()"> Monthly
                </label>
            </div>

            <!-- Statistics Summary Cards -->
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-label">Total Spent (Period)</div>
                    <div class="stat-value" id="periodTotal">₱0.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average Daily</div>
                    <div class="stat-value" id="avgDaily">₱0.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Most Expensive Category</div>
                    <div class="stat-value" id="topCategory">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Most Used Payment</div>
                    <div class="stat-value" id="topPayment">-</div>
                </div>
            </div>

        <!-- Charts Section -->
        <div class="chart-section">
            <h2>Expense Breakdown by Category</h2>
            <div id="chartDisplay">
                <div class="chart-container">
                    <canvas id="expenseChart"></canvas>
                </div>
                <div class="chart-legend" id="chartLegend"></div>
            </div>
            <div id="noDataMessage" class="no-data-message" style="display: none;">
                No expenses to display. Add expenses to see the breakdown!
            </div>
        </div>

        <!-- Payment Source Chart -->
        <div class="chart-section" style="margin-top: 20px;">
            <h2>Spending by Payment Source</h2>
            <div id="paymentChartDisplay">
                <div class="chart-container">
                    <canvas id="paymentChart"></canvas>
                </div>
            </div>
            <div id="noPaymentData" class="no-data-message" style="display: none;">
                No payment data to display.
            </div>
        </div>
        </div>
        <!-- END STATISTICS TAB -->

        <!-- Savings Modal -->
        <div id="savingsModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeSavingsModal()">&times;</span>
                <h2 id="modalTitle" style="color: #8B1538; margin-bottom: 20px; font-size: 24px;">Add Money</h2>
                <form id="savingsForm" onsubmit="submitSavingsTransaction(event)">
                    <div class="form-group">
                        <label for="savingsAmount">Amount (₱)</label>
                        <input type="number" id="savingsAmount" step="0.01" min="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="savingsNote">Note (Optional)</label>
                        <input type="text" id="savingsNote" placeholder="e.g., Monthly savings">
                    </div>
                    <button type="submit" class="btn btn-add" style="width: 100%;">Confirm</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Store expenses and savings data in memory
        let expenses = [];
        let accounts = {
            GCash: {
                'GCash - General': 0
            },
            SeaBank: {
                'SeaBank - General': 0
            },
            Cash: {
                'Cash - Wallet': 0
            }
        };
        let totalMoneyAdded = 0; // Lifetime total - NEVER decreases
        let currentSavingsAccount = '';
        let currentSavingsCategory = '';
        let currentSavingsAction = '';

        // Category colors for pie chart
        const categoryColors = {
            'Food': '#FF6384',
            'Transport': '#36A2EB',
            'Entertainment': '#FFCE56',
            'Shopping': '#4BC0C0',
            'Bills': '#9966FF',
            'Other': '#FF9F40'
        };

        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();

        // Initialize the app
        initializeApp();

        function initializeApp() {
            renderAllCategories();
            updateAllDisplays();
            updatePaidFromDropdown();
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Update displays
            if (tabName === 'accounts') {
                updateAccountsDisplay();
            } else if (tabName === 'statistics') {
                updateStatistics();
            }
        }

        // Focus on description field when page loads
        window.onload = function() {
            document.getElementById('description').focus();
        };

        // Handle form submission
        document.getElementById('expenseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addExpense();
        });

        // Handle category filter
        document.getElementById('filterCategory').addEventListener('change', function() {
            displayExpenses();
        });

        function addExpense() {
            const description = document.getElementById('description').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const category = document.getElementById('category').value;
            const paidFrom = document.getElementById('paidFrom').value;
            const date = document.getElementById('date').value;

            // Validation
            if (!description || !amount || !category || !paidFrom || !date) {
                alert('Please fill in all fields');
                return;
            }

            if (amount <= 0) {
                alert('Amount must be greater than 0');
                return;
            }

            // Find the account and category
            let accountType = null;
            let categoryName = null;
            
            for (let acc in accounts) {
                if (accounts[acc][paidFrom] !== undefined) {
                    accountType = acc;
                    categoryName = paidFrom;
                    break;
                }
            }

            if (!accountType || !categoryName) {
                alert('Invalid payment source selected');
                return;
            }

            // Check if sufficient balance
            if (accounts[accountType][categoryName] < amount) {
                alert('You don\'t have enough money in this category');
                return;
            }

            // Create expense object
            const expense = {
                id: Date.now(),
                description: description,
                amount: amount,
                category: category,
                paidFrom: paidFrom,
                date: date
            };

            // Deduct from category
            accounts[accountType][categoryName] -= amount;

            // Add to expenses array
            expenses.push(expense);

            // Show success message
            showSuccessMessage();

            // Reset form
            document.getElementById('expenseForm').reset();
            document.getElementById('date').valueAsDate = new Date();
            document.getElementById('description').focus();

            // Update display
            displayExpenses();
            updateSummary();
            updateChart();
            updateAllDisplays();
            updatePaidFromDropdown();
        }

        function updatePaidFromDropdown() {
            const select = document.getElementById('paidFrom');
            const currentValue = select.value;
            select.innerHTML = '<option value="">Select payment source</option>';
            
            // Add all categories from all accounts
            ['GCash', 'SeaBank', 'Cash'].forEach(accountType => {
                Object.keys(accounts[accountType]).forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    select.appendChild(option);
                });
            });
            
            // Restore previous selection if it still exists
            if (currentValue) {
                select.value = currentValue;
            }
        }

        function showSuccessMessage() {
            const message = document.getElementById('successMessage');
            message.style.display = 'block';
            setTimeout(function() {
                message.style.display = 'none';
            }, 3000);
        }

        function deleteExpense(id) {
            if (confirm('Are you sure you want to delete this expense?')) {
                expenses = expenses.filter(expense => expense.id !== id);
                displayExpenses();
                updateSummary();
                updateChart();
            }
        }

        function clearAllExpenses() {
            if (expenses.length === 0) {
                alert('No expenses to clear!');
                return;
            }

            if (confirm('Are you sure you want to delete ALL expenses? This cannot be undone!')) {
                expenses = [];
                displayExpenses();
                updateSummary();
                updateChart();
            }
        }

        function displayExpenses() {
            const tbody = document.getElementById('expenseTableBody');
            const filter = document.getElementById('filterCategory').value;

            // Filter expenses
            let filteredExpenses = expenses;
            if (filter !== 'all') {
                filteredExpenses = expenses.filter(expense => expense.category === filter);
            }

            // Sort by date (newest first)
            filteredExpenses.sort((a, b) => new Date(b.date) - new Date(a.date));

            // Clear table
            tbody.innerHTML = '';

            if (filteredExpenses.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty-message">No expenses found.</td></tr>';
                return;
            }

            // Add rows
            filteredExpenses.forEach(expense => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(expense.date)}</td>
                    <td>${expense.description}</td>
                    <td><span class="category-badge category-${expense.category.toLowerCase()}">${expense.category}</span></td>
                    <td>${expense.paidFrom || 'N/A'}</td>
                    <td class="amount-cell">₱${expense.amount.toFixed(2)}</td>
                    <td><button class="btn btn-delete" onclick="deleteExpense(${expense.id})">Delete</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateSummary() {
            const total = expenses.reduce((sum, expense) => sum + expense.amount, 0);
            const count = expenses.length;

            document.getElementById('totalAmount').textContent = '₱' + total.toFixed(2);
            document.getElementById('transactionCount').textContent = count + ' transaction' + (count !== 1 ? 's' : '');
        }

        function formatDate(dateString) {
            const date = new Date(dateString + 'T00:00:00');
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        function updateChart() {
            if (expenses.length === 0) {
                document.getElementById('chartDisplay').style.display = 'none';
                document.getElementById('noDataMessage').style.display = 'block';
                return;
            }

            document.getElementById('chartDisplay').style.display = 'block';
            document.getElementById('noDataMessage').style.display = 'none';

            // Calculate category totals
            const categoryTotals = {};
            let total = 0;

            expenses.forEach(expense => {
                if (!categoryTotals[expense.category]) {
                    categoryTotals[expense.category] = 0;
                }
                categoryTotals[expense.category] += expense.amount;
                total += expense.amount;
            });

            // Draw pie chart
            drawPieChart(categoryTotals, total);
            
            // Update legend
            updateLegend(categoryTotals, total);
        }

        function drawPieChart(categoryTotals, total) {
            const canvas = document.getElementById('expenseChart');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = 400;
            canvas.height = 400;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 20;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw pie slices
            let startAngle = -Math.PI / 2; // Start at top
            
            Object.keys(categoryTotals).forEach(category => {
                const sliceAngle = (categoryTotals[category] / total) * 2 * Math.PI;
                
                // Draw slice
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
                ctx.closePath();
                
                ctx.fillStyle = categoryColors[category];
                ctx.fill();
                
                // Add border
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Draw percentage label
                const percentage = (categoryTotals[category] / total) * 100;
                if (percentage > 5) { // Only show label if slice is large enough
                    const labelAngle = startAngle + sliceAngle / 2;
                    const labelX = centerX + (radius * 0.7) * Math.cos(labelAngle);
                    const labelY = centerY + (radius * 0.7) * Math.sin(labelAngle);
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(percentage.toFixed(1) + '%', labelX, labelY);
                }
                
                startAngle += sliceAngle;
            });
        }

        function updateLegend(categoryTotals, total) {
            const legend = document.getElementById('chartLegend');
            legend.innerHTML = '';
            
            Object.keys(categoryTotals).sort((a, b) => categoryTotals[b] - categoryTotals[a]).forEach(category => {
                const percentage = (categoryTotals[category] / total) * 100;
                const amount = categoryTotals[category];
                
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-color" style="background-color: ${categoryColors[category]}"></div>
                    <div class="legend-details">
                        <div class="legend-category">${category}</div>
                        <div class="legend-amount">₱${amount.toFixed(2)}</div>
                        <div class="legend-percentage">${percentage.toFixed(1)}% of total</div>
                    </div>
                `;
                legend.appendChild(legendItem);
            });
        }

        // Savings Management Functions
        function renderAllCategories() {
            renderAccountCategories('GCash', 'gcashCategoriesContainer');
            renderAccountCategories('SeaBank', 'seabankCategoriesContainer');
            renderAccountCategories('Cash', 'cashCategoriesContainer');
        }

        function renderAccountCategories(accountType, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            const categories = accounts[accountType];
            
            if (Object.keys(categories).length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px; font-size: 16px;">No categories yet. Click + to add one.</p>';
                return;
            }
            
            Object.keys(categories).forEach(category => {
                const row = document.createElement('div');
                row.className = 'category-row';
                row.innerHTML = `
                    <div class="category-header">
                        <span class="category-name">${category}</span>
                        <span class="category-balance">₱${categories[category].toFixed(2)}</span>
                    </div>
                <div class="category-actions">
    <!-- Add Money button: full width row above -->
    <button class="btn btn-add-money" 
            style="width:100%; margin-bottom:10px; background-color:#28a745; color:white; border:none; padding:10px; border-radius:5px; font-weight:600; cursor:pointer;" 
            onclick="showSavingsModal('${accountType}', '${category}', 'add')">
        + Add Money
    </button>

    <!-- Remove and Delete: flex row below, side by side and equal width -->
    <div style="display: flex; gap:10px;">
        <button class="btn btn-remove-money" 
                style="flex:1; background-color:#A88905; color:white; border:none; padding:10px; border-radius:5px; font-weight:600; cursor:pointer;" 
                onclick="showSavingsModal('${accountType}', '${category}', 'remove')">
            Remove Money
        </button>

        <button class="btn btn-delete" 
                style="flex:1; background-color:#dc3545; color:white; border:none; padding:10px; border-radius:5px; font-weight:600; cursor:pointer;" 
                onclick="deleteCategory('${accountType}', '${category}')">
            Delete
        </button>
    </div>
</div>


                `;
                container.appendChild(row);
            });
        }

        function showAddCategoryForm(accountType) {
            const formId = 'add' + accountType + 'Form';
            const formDiv = document.getElementById(formId);
            
            if (formDiv.style.display === 'block') {
                formDiv.style.display = 'none';
                return;
            }
            
            formDiv.style.display = 'block';
            formDiv.innerHTML = `
                <div class="add-category-form">
                    <h4 style="margin-bottom: 15px; color: #8B1538; font-size: 18px;">Add New ${accountType} Category</h4>
                    <input type="text" id="newCategory${accountType}" placeholder="Enter category name (e.g., ${accountType} - Bills)" style="width: 100%; font-size: 18px; padding: 14px;">
                    <div style="margin-top: 15px;">
                        <button class="btn btn-add" onclick="saveNewCategory('${accountType}')">Save</button>
                        <button class="btn" style="background-color: #999; color: white;" onclick="cancelAddCategory('${accountType}')">Cancel</button>
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                document.getElementById('newCategory' + accountType).focus();
            }, 100);
        }

        function cancelAddCategory(accountType) {
            const formId = 'add' + accountType + 'Form';
            document.getElementById(formId).style.display = 'none';
        }

        function saveNewCategory(accountType) {
            const input = document.getElementById('newCategory' + accountType);
            const categoryName = input.value.trim();
            
            if (!categoryName) {
                alert('Please enter a category name');
                return;
            }
            
            if (accounts[accountType][categoryName]) {
                alert('This category already exists');
                return;
            }
            
            accounts[accountType][categoryName] = 0;
            cancelAddCategory(accountType);
            renderAllCategories();
            updateAllDisplays();
            updatePaidFromDropdown();
            
            const msg = document.getElementById('successMessage');
            msg.textContent = `Category "${categoryName}" added successfully!`;
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 3000);
        }

        function deleteCategory(accountType, category) {
            if (accounts[accountType][category] > 0) {
                alert('Cannot delete category with balance. Remove all money first.');
                return;
            }
            
            if (confirm(`Are you sure you want to delete "${category}"?`)) {
                delete accounts[accountType][category];
                renderAllCategories();
                updateAllDisplays();
                updatePaidFromDropdown();
                
                const msg = document.getElementById('successMessage');
                msg.textContent = `Category "${category}" deleted successfully!`;
                msg.style.display = 'block';
                setTimeout(() => msg.style.display = 'none', 3000);
            }
        }

        function showSavingsModal(accountType, category, action) {
            currentSavingsAccount = accountType;
            currentSavingsCategory = category;
            currentSavingsAction = action;
            
            document.getElementById('modalTitle').textContent = 
                `${action === 'add' ? 'Add' : 'Remove'} Money - ${category}`;
            
            document.getElementById('savingsModal').style.display = 'block';
            document.getElementById('savingsAmount').value = '';
            document.getElementById('savingsNote').value = '';
            document.getElementById('savingsAmount').focus();
        }

        function closeSavingsModal() {
            document.getElementById('savingsModal').style.display = 'none';
        }

        function submitSavingsTransaction(event) {
            event.preventDefault();
            
            const amount = parseFloat(document.getElementById('savingsAmount').value);
            
            if (!amount || amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            
            if (currentSavingsAction === 'remove') {
                // Check sufficient balance
                if (accounts[currentSavingsAccount][currentSavingsCategory] < amount) {
                    alert('You don\'t have enough money in this category');
                    return;
                }
                accounts[currentSavingsAccount][currentSavingsCategory] -= amount;
                // Do NOT touch totalMoneyAdded
            } else {
                // Add money
                accounts[currentSavingsAccount][currentSavingsCategory] += amount;
                totalMoneyAdded += amount; // Increment lifetime total
            }
            
            closeSavingsModal();
            updateAllDisplays();
            renderAllCategories();
            
            const msg = document.getElementById('successMessage');
            msg.textContent = `${currentSavingsAction === 'add' ? 'Added' : 'Removed'} ₱${amount.toFixed(2)} successfully!`;
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 3000);
        }

        function updateAllDisplays() {
            // Update accounts tab
            updateAccountsDisplay();
        }

        function updateAccountsDisplay() {
            // Calculate totals
            const gcashTotal = Object.values(accounts.GCash).reduce((sum, val) => sum + val, 0);
            const seabankTotal = Object.values(accounts.SeaBank).reduce((sum, val) => sum + val, 0);
            const cashTotal = Object.values(accounts.Cash).reduce((sum, val) => sum + val, 0);
            const totalSavings = gcashTotal + seabankTotal + cashTotal;
            const totalSpent = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const remaining = totalSavings - totalSpent;
            
            document.getElementById('totalSavings').textContent = '₱' + totalSavings.toFixed(2);
            document.getElementById('totalSpent').textContent = '₱' + totalSpent.toFixed(2);
            document.getElementById('remainingBalance').textContent = '₱' + remaining.toFixed(2);
            
            // Build detailed account view
            const container = document.getElementById('accountsDetailView');
            container.innerHTML = '';
            
            // GCash card
            const gcashCard = document.createElement('div');
            gcashCard.className = 'account-detail-card';
            gcashCard.innerHTML = `
                <h3 style="color: #8B1538; margin-bottom: 15px; font-size: 22px;">GCash</h3>
                <div class="account-balance-large">₱${gcashTotal.toFixed(2)}</div>
                <div class="cash-breakdown">
                    ${Object.keys(accounts.GCash).map(cat => `
                        <div class="cash-category-item">
                            <span style="font-size: 16px;">${cat}</span>
                            <span style="font-weight: bold; color: #8B1538; font-size: 18px;">₱${accounts.GCash[cat].toFixed(2)}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            container.appendChild(gcashCard);
            
            // SeaBank card
            const seabankCard = document.createElement('div');
            seabankCard.className = 'account-detail-card';
            seabankCard.innerHTML = `
                <h3 style="color: #8B1538; margin-bottom: 15px; font-size: 22px;">SeaBank</h3>
                <div class="account-balance-large">₱${seabankTotal.toFixed(2)}</div>
                <div class="cash-breakdown">
                    ${Object.keys(accounts.SeaBank).map(cat => `
                        <div class="cash-category-item">
                            <span style="font-size: 16px;">${cat}</span>
                            <span style="font-weight: bold; color: #8B1538; font-size: 18px;">₱${accounts.SeaBank[cat].toFixed(2)}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            container.appendChild(seabankCard);
            
            // Cash card
            const cashCard = document.createElement('div');
            cashCard.className = 'account-detail-card';
            cashCard.innerHTML = `
                <h3 style="color: #8B1538; margin-bottom: 15px; font-size: 22px;">Cash</h3>
                <div class="account-balance-large">₱${cashTotal.toFixed(2)}</div>
                <div class="cash-breakdown">
                    ${Object.keys(accounts.Cash).map(cat => `
                        <div class="cash-category-item">
                            <span style="font-size: 16px;">${cat}</span>
                            <span style="font-weight: bold; color: #8B1538; font-size: 18px;">₱${accounts.Cash[cat].toFixed(2)}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            container.appendChild(cashCard);
        }

        function updateStatistics() {
            const period = document.querySelector('input[name="timePeriod"]:checked').value;
            const now = new Date();
            
            // Filter expenses by period
            let filteredExpenses = expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                
                if (period === 'daily') {
                    return expenseDate.toDateString() === now.toDateString();
                } else if (period === 'weekly') {
                    const weekAgo = new Date(now);
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    return expenseDate >= weekAgo && expenseDate <= now;
                } else { // monthly
                    return expenseDate.getMonth() === now.getMonth() && 
                           expenseDate.getFullYear() === now.getFullYear();
                }
            });
            
            // Calculate statistics
            const periodTotal = filteredExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            
            let days = 1;
            if (period === 'weekly') days = 7;
            else if (period === 'monthly') days = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            
            const avgDaily = periodTotal / days;
            
            // Find top category
            const categoryTotals = {};
            filteredExpenses.forEach(exp => {
                categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;
            });
            const topCategory = Object.keys(categoryTotals).length > 0 ? 
                Object.keys(categoryTotals).reduce((a, b) => categoryTotals[a] > categoryTotals[b] ? a : b) : '-';
            
            // Find top payment method (by account type)
            const paymentTotals = {};
            filteredExpenses.forEach(exp => {
                if (exp.paidFrom) {
                    let accountType = null;
                    if (accounts.GCash[exp.paidFrom]) accountType = 'GCash';
                    else if (accounts.SeaBank[exp.paidFrom]) accountType = 'SeaBank';
                    else if (accounts.Cash[exp.paidFrom]) accountType = 'Cash';
                    
                    if (accountType) {
                        paymentTotals[accountType] = (paymentTotals[accountType] || 0) + exp.amount;
                    }
                }
            });
            const topPayment = Object.keys(paymentTotals).length > 0 ? 
                Object.keys(paymentTotals).reduce((a, b) => paymentTotals[a] > paymentTotals[b] ? a : b) : '-';
            
            // Update display
            document.getElementById('periodTotal').textContent = '₱' + periodTotal.toFixed(2);
            document.getElementById('avgDaily').textContent = '₱' + avgDaily.toFixed(2);
            document.getElementById('topCategory').textContent = topCategory;
            document.getElementById('topPayment').textContent = topPayment;
            
            // Update charts with filtered data
            updateChartWithData(filteredExpenses);
            updatePaymentChart(filteredExpenses);
        }

        function updateChartWithData(filteredExpenses) {
            if (filteredExpenses.length === 0) {
                document.getElementById('chartDisplay').style.display = 'none';
                document.getElementById('noDataMessage').style.display = 'block';
                return;
            }

            document.getElementById('chartDisplay').style.display = 'block';
            document.getElementById('noDataMessage').style.display = 'none';

            // Calculate category totals
            const categoryTotals = {};
            let total = 0;

            filteredExpenses.forEach(expense => {
                if (!categoryTotals[expense.category]) {
                    categoryTotals[expense.category] = 0;
                }
                categoryTotals[expense.category] += expense.amount;
                total += expense.amount;
            });

            drawPieChart(categoryTotals, total);
            updateLegend(categoryTotals, total);
        }

        function updatePaymentChart(filteredExpenses) {
            if (filteredExpenses.length === 0) {
                document.getElementById('paymentChartDisplay').style.display = 'none';
                document.getElementById('noPaymentData').style.display = 'block';
                return;
            }

            document.getElementById('paymentChartDisplay').style.display = 'block';
            document.getElementById('noPaymentData').style.display = 'none';

            // Group by account type (GCash, SeaBank, Cash)
            const paymentTotals = {};
            filteredExpenses.forEach(expense => {
                if (expense.paidFrom) {
                    // Determine which account type this category belongs to
                    let accountType = null;
                    if (accounts.GCash[expense.paidFrom]) accountType = 'GCash';
                    else if (accounts.SeaBank[expense.paidFrom]) accountType = 'SeaBank';
                    else if (accounts.Cash[expense.paidFrom]) accountType = 'Cash';
                    
                    if (accountType) {
                        paymentTotals[accountType] = (paymentTotals[accountType] || 0) + expense.amount;
                    }
                }
            });

            drawPaymentBarChart(paymentTotals);
        }

        function drawPaymentBarChart(paymentTotals) {
            const canvas = document.getElementById('paymentChart');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 600;
            canvas.height = 400;
            
            const padding = 60;
            const barWidth = 80;
            const maxAmount = Math.max(...Object.values(paymentTotals), 1);
            const chartHeight = canvas.height - padding * 2;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const colors = {'GCash': '#36A2EB', 'SeaBank': '#4BC0C0', 'Cash': '#FFCE56'};
            const payments = Object.keys(paymentTotals);
            const spacing = (canvas.width - padding * 2) / payments.length;
            
            payments.forEach((payment, index) => {
                const amount = paymentTotals[payment];
                const barHeight = (amount / maxAmount) * chartHeight;
                const x = padding + index * spacing + (spacing - barWidth) / 2;
                const y = canvas.height - padding - barHeight;
                
                // Draw bar
                ctx.fillStyle = colors[payment] || '#999';
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Draw amount on top
                ctx.fillStyle = '#333';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('₱' + amount.toFixed(0), x + barWidth / 2, y - 5);
                
                // Draw label
                ctx.fillStyle = '#666';
                ctx.font = '14px Arial';
                ctx.fillText(payment, x + barWidth / 2, canvas.height - padding + 20);
            });
            
            // Draw axes
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('savingsModal');
            if (event.target === modal) {
                closeSavingsModal();
            }
        };

        // Initialize chart on page load
        window.addEventListener('load', function() {
            updateChart();
            updateStatistics();
        });
    </script>
</body>
</html>
